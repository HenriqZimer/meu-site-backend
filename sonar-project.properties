# SonarQube Configuration for Backend (NestJS)

# Project identification
# sonar.projectKey será definido via CLI
# sonar.projectName será definido via CLI

# Source code location
sonar.sources=src
sonar.tests=src

# Test patterns
sonar.test.inclusions=**/*.spec.ts,**/*.test.ts

# Exclusions - Arquivos que NÃO devem ser analisados
sonar.exclusions=\
  **/node_modules/**,\
  **/dist/**,\
  **/coverage/**,\
  **/*.spec.ts,\
  **/*.test.ts,\
  **/*.config.{js,ts,mjs}

# Coverage exclusions - Arquivos que não precisam de cobertura
sonar.coverage.exclusions=\
  **/*.spec.ts,\
  **/*.test.ts,\
  **/*.config.{js,ts},\
  **/main.ts,\
  **/app.module.ts,\
  **/*.module.ts,\
  **/*.dto.ts,\
  **/*.schema.ts,\
  **/*.interface.ts,\
  **/*.entity.ts

# Coverage report paths
sonar.javascript.lcov.reportPaths=coverage/lcov.info

# TypeScript specific
sonar.typescript.node.maxspace=4096

# Coverage thresholds - Realistas para backend NestJS
sonar.coverage.min=60.0
sonar.coverage.minNewCode=60.0

# Encoding
sonar.sourceEncoding=UTF-8

# Language
sonar.language=ts

# New Code Definition
sonar.newCode.referenceBranch=develop

# SCM Integration
sonar.scm.disabled=false

# Performance tuning
sonar.log.level=INFO

# Duplicated code detection
sonar.cpd.exclusions=\
  **/*.dto.ts,\
  **/*.entity.ts,\
  **/*.schema.ts

# Code Smells - Ajustes para NestJS
# NestJS usa decorators que podem gerar falsos positivos
sonar.issue.ignore.multicriteria=e1,e2

# Ignora: Cognitive Complexity em controllers (DI do NestJS aumenta complexidade aparente)
sonar.issue.ignore.multicriteria.e1.ruleKey=typescript:S3776
sonar.issue.ignore.multicriteria.e1.resourceKey=**/*.controller.ts

# Ignora: Too many parameters em constructors (DI do NestJS)
sonar.issue.ignore.multicriteria.e2.ruleKey=typescript:S107
sonar.issue.ignore.multicriteria.e2.resourceKey=**/*.service.ts
